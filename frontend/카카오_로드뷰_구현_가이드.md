# 프론트엔드 카카오 로드뷰 구현 가이드

## 개요

프론트엔드에서 카카오 로드뷰 JavaScript API를 사용하여 사용자에게 로드뷰를 표시합니다.

> **참고**: 백엔드에서는 Google Street View Static API를 사용하여 AI 분석용 이미지를 가져옵니다. 프론트엔드에서는 사용자 경험을 위해 카카오 로드뷰를 표시합니다.

---

## 카카오 로드뷰 JavaScript API 설정

### 1. 카카오 개발자 콘솔 설정

1. [카카오 개발자 콘솔](https://developers.kakao.com/) 접속
2. 애플리케이션 선택
3. **앱 설정** → **앱 키** 메뉴에서 **JavaScript 키** 확인
4. **제품 설정** → **카카오맵** → **플랫폼** → **Web 플랫폼**에 도메인 등록:
   ```
   http://localhost:3000
   ```

### 2. HTML에 카카오맵 SDK 추가

```html
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StartSmart - 분석 결과</title>
</head>
<body>
  <!-- 로드뷰 컨테이너 -->
  <div id="roadview-container" style="width:100%;height:400px;"></div>

  <!-- 카카오맵 SDK (로드뷰 포함) -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_JAVASCRIPT_KEY&libraries=services"></script>
  
  <script>
    // 로드뷰 초기화 코드
  </script>
</body>
</html>
```

> **주의**: `YOUR_JAVASCRIPT_KEY`를 실제 JavaScript 키로 교체하세요. 환경변수로 관리하는 것을 권장합니다.

---

## 카카오 로드뷰 구현 예시

### 기본 로드뷰 표시

```javascript
// frontend/report/roadview.js

/**
 * 카카오 로드뷰 초기화 및 표시
 * @param {Object} location - 위치 정보 { lat, lng }
 * @param {string} containerId - 로드뷰를 표시할 컨테이너 ID
 */
function initKakaoRoadview(location, containerId = 'roadview-container') {
  const container = document.getElementById(containerId);
  
  if (!container) {
    console.error('로드뷰 컨테이너를 찾을 수 없습니다:', containerId);
    return;
  }

  // 로드뷰 객체 생성
  const roadview = new kakao.maps.Roadview(container);
  const roadviewClient = new kakao.maps.RoadviewClient();

  // 좌표로 가장 가까운 파노라마 ID 조회
  roadviewClient.getNearestPanoId(location.lng, location.lat, 50, function(panoId) {
    if (panoId === null) {
      console.warn('해당 위치에 로드뷰가 없습니다.');
      // 로드뷰가 없는 경우 대체 메시지 표시
      container.innerHTML = '<p>해당 위치에 로드뷰가 없습니다.</p>';
      return;
    }
    
    // 파노라마 ID로 로드뷰 표시
    roadview.setPanoId(panoId, 0); // 0은 각도 (0~360)
  });
}
```

### 분석 결과와 함께 로드뷰 표시

```javascript
// frontend/report/displayResult.js

/**
 * 분석 결과를 표시하고 로드뷰도 함께 표시
 * @param {Object} analysisResult - 백엔드에서 받은 분석 결과
 */
function displayAnalysisResult(analysisResult) {
  // 분석 결과 표시
  displayFinance(analysisResult.finance);
  displayDecision(analysisResult.decision);
  displayMarket(analysisResult.market);
  displayAIConsulting(analysisResult.aiConsulting);
  
  // 로드뷰 표시
  if (analysisResult.roadview && analysisResult.roadview.location) {
    initKakaoRoadview(analysisResult.roadview.location);
  }
}
```

### 로드뷰 제어 기능 추가

```javascript
// frontend/report/roadview.js (확장)

/**
 * 카카오 로드뷰 초기화 및 제어 기능 포함
 */
function initKakaoRoadviewWithControls(location, containerId = 'roadview-container') {
  const container = document.getElementById(containerId);
  
  if (!container) {
    console.error('로드뷰 컨테이너를 찾을 수 없습니다:', containerId);
    return;
  }

  const roadview = new kakao.maps.Roadview(container);
  const roadviewClient = new kakao.maps.RoadviewClient();

  // 로드뷰 이벤트 리스너
  kakao.maps.event.addListener(roadview, 'init', function() {
    console.log('로드뷰 초기화 완료');
  });

  kakao.maps.event.addListener(roadview, 'panoid_changed', function() {
    const panoId = roadview.getPanoId();
    console.log('파노라마 ID 변경:', panoId);
  });

  // 좌표로 파노라마 ID 조회
  roadviewClient.getNearestPanoId(location.lng, location.lat, 50, function(panoId) {
    if (panoId === null) {
      container.innerHTML = '<p>해당 위치에 로드뷰가 없습니다.</p>';
      return;
    }
    
    roadview.setPanoId(panoId, 0);
  });

  // 로드뷰 제어 버튼 추가 (선택사항)
  addRoadviewControls(roadview);
}

/**
 * 로드뷰 제어 버튼 추가
 */
function addRoadviewControls(roadview) {
  const controls = document.createElement('div');
  controls.style.cssText = 'position:absolute;top:10px;right:10px;z-index:1000;';
  
  // 회전 버튼
  const rotateLeft = document.createElement('button');
  rotateLeft.textContent = '←';
  rotateLeft.onclick = () => {
    const currentAngle = roadview.getViewpoint().pan;
    roadview.setViewpoint({ pan: currentAngle - 30 }, 300);
  };
  
  const rotateRight = document.createElement('button');
  rotateRight.textContent = '→';
  rotateRight.onclick = () => {
    const currentAngle = roadview.getViewpoint().pan;
    roadview.setViewpoint({ pan: currentAngle + 30 }, 300);
  };
  
  controls.appendChild(rotateLeft);
  controls.appendChild(rotateRight);
  
  const container = roadview.getContainer();
  container.style.position = 'relative';
  container.appendChild(controls);
}
```

---

## 환경변수 관리

### JavaScript 키를 환경변수로 관리

```html
<!-- frontend/report/index.html -->
<head>
  <script>
    // 환경변수에서 카카오 JavaScript 키 가져오기
    window.KAKAO_JAVASCRIPT_KEY = 'YOUR_JAVASCRIPT_KEY'; // 또는 환경변수에서 주입
  </script>
  <script type="text/javascript" 
          src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_JAVASCRIPT_KEY&libraries=services">
  </script>
</head>
```

> **보안 주의**: JavaScript 키는 클라이언트에 노출되므로, 도메인 제한을 반드시 설정하세요.

---

## 백엔드와의 연동

### 분석 결과에서 로드뷰 위치 정보 가져오기

```javascript
// frontend/report/script.js

async function loadAnalysisResult(analysisId) {
  try {
    const response = await fetch(`${API_BASE_URL}/api/result/${analysisId}`);
    const data = await response.json();
    
    if (data.result.status === 'completed') {
      const result = data.result.result;
      
      // 로드뷰 위치 정보
      const roadviewLocation = result.roadview?.location || result.location;
      
      if (roadviewLocation) {
        // 카카오 로드뷰 표시
        initKakaoRoadview(roadviewLocation);
      }
      
      // 나머지 분석 결과 표시
      displayAnalysisResult(result);
    }
  } catch (error) {
    console.error('분석 결과 로드 실패:', error);
  }
}
```

---

## 주의사항

### 1. 도메인 등록 필수
- 카카오 개발자 콘솔에서 사용할 도메인을 반드시 등록해야 합니다.
- `http://localhost:3000` (개발 환경)
- 실제 배포 도메인 (프로덕션)

### 2. JavaScript 키 vs REST API 키
- **JavaScript 키**: 프론트엔드에서 사용 (로드뷰 표시)
- **REST API 키**: 백엔드에서 사용 (지도 검색 등)

### 3. 로드뷰 데이터 가용성
- 모든 위치에 로드뷰가 있는 것은 아닙니다.
- `getNearestPanoId`가 `null`을 반환할 수 있으므로 에러 처리가 필요합니다.

### 4. 백엔드 AI 분석과의 관계
- **프론트엔드**: 카카오 로드뷰로 사용자에게 표시
- **백엔드**: Google Street View로 AI 분석 수행
- 두 가지는 독립적으로 동작하며, 사용자 경험과 AI 분석을 모두 제공합니다.

---

## 완성 예시

```html
<!-- frontend/report/index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>분석 결과 - StartSmart</title>
  <style>
    #roadview-container {
      width: 100%;
      height: 400px;
      margin: 20px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>분석 결과</h1>
  
  <!-- 분석 결과 표시 영역 -->
  <div id="analysis-result"></div>
  
  <!-- 로드뷰 표시 영역 -->
  <h2>입지 로드뷰</h2>
  <div id="roadview-container"></div>
  
  <!-- 카카오맵 SDK -->
  <script type="text/javascript" 
          src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_JAVASCRIPT_KEY&libraries=services">
  </script>
  
  <!-- 로드뷰 초기화 스크립트 -->
  <script src="roadview.js"></script>
  <script src="script.js"></script>
</body>
</html>
```

---

## 참고 자료

- [카카오 로드뷰 API 가이드](https://apis.map.kakao.com/web/sample/basicRoadview/)
- [카카오 로드뷰 JavaScript API 문서](https://apis.map.kakao.com/web/documentation/#load)
- [카카오 개발자 콘솔](https://developers.kakao.com/)

---

## 요약

✅ **프론트엔드에서 카카오 로드뷰 JavaScript API 사용**
- 사용자에게 로드뷰 표시
- 분석 결과와 함께 시각화

✅ **백엔드에서는 Google Street View 사용**
- AI 분석용 이미지 가져오기
- Gemini Vision API로 분석

이렇게 하면 사용자 경험과 AI 분석을 모두 제공할 수 있습니다!
