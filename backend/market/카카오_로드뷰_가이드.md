# 카카오 로드뷰 API 호출 가이드

## ⚠️ 중요: 카카오 로드뷰의 제한사항

**카카오 로드뷰는 서버 사이드에서 직접 호출할 수 없습니다!**

카카오 로드뷰는 **JavaScript API만 제공**하며, 서버 사이드 REST API는 없습니다.

---

## 해결 방법

### 방법 1: Google Street View Static API 사용 (권장) ✅

**실제 로드뷰 이미지**를 가져올 수 있습니다.

```javascript
const imageUrl = `https://maps.googleapis.com/maps/api/streetview?size=640x640&location=${lat},${lng}&key=${GOOGLE_MAPS_API_KEY}`;
```

**장점**:
- 서버 사이드에서 직접 호출 가능
- 실제 로드뷰 이미지 URL 반환
- Gemini Vision API로 분석 가능

**필요한 설정**:
- `.env`에 `GOOGLE_MAPS_API_KEY` 추가
- Google Cloud Console에서 Street View Static API 활성화

---

### 방법 2: 카카오 로드뷰 페이지 링크 생성

**로드뷰 페이지 링크**만 생성 가능합니다.

```javascript
const roadviewUrl = `https://map.kakao.com/link/roadview/${lat},${lng}`;
```

**장점**:
- API 키만 있으면 바로 사용 가능
- 사용자가 브라우저에서 로드뷰 확인 가능

**단점**:
- 서버 사이드에서 이미지를 직접 가져올 수 없음
- Gemini Vision API로 분석 불가

---

### 방법 3: 프론트엔드에서 카카오 로드뷰 JavaScript API 사용

**프론트엔드에서만 가능**합니다.

```html
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_APP_KEY&libraries=services"></script>
<script>
  // 카카오 로드뷰 JavaScript API 사용
  const roadview = new kakao.maps.Roadview(document.getElementById('roadview'));
  const roadviewClient = new kakao.maps.RoadviewClient();
  
  // 좌표로 파노라마 ID 조회
  roadviewClient.getNearestPanoId(lng, lat, 50, function(panoId) {
    roadview.setPanoId(panoId, 0); // 파노라마 ID로 로드뷰 설정
  });
</script>
```

**장점**:
- 실제 카카오 로드뷰 사용 가능
- 파노라마 ID로 이미지 접근 가능

**단점**:
- 서버 사이드에서 사용 불가
- 프론트엔드에서만 동작

---

## 현재 프로젝트 구현

### `backend/market/roadviewApi.js`

현재 구현된 함수들:

1. **`getKakaoRoadview(location)`**
   - 카카오 로드뷰 페이지 링크 생성
   - 서버 사이드에서 이미지 직접 호출 불가

2. **`getGoogleStreetViewUrl(location, options)`**
   - Google Street View Static API 사용
   - 실제 로드뷰 이미지 URL 반환 ✅

3. **`getNaverRoadviewUrl(location, options)`**
   - 네이버 Static Map API 사용
   - 로드뷰가 아닌 지도 이미지 (대안)

4. **`getRoadviewImageUrl(location)`**
   - 우선순위: Google > 네이버 > 카카오
   - 사용 가능한 API로 로드뷰/지도 이미지 URL 반환

---

## 테스트 방법

```bash
# 로드뷰 API 테스트
node backend/market/test-roadview.js
```

**예상 결과**:
- Google Street View: 실제 로드뷰 이미지 URL (API 키 필요)
- 네이버 Static Map: 지도 이미지 URL (로드뷰 아님)
- 카카오 로드뷰: 로드뷰 페이지 링크 (이미지 직접 호출 불가)

---

## 권장 사용 방법

### AI 로드뷰 분석을 위한 경우

**Google Street View Static API 사용 권장**:

1. `.env`에 `GOOGLE_MAPS_API_KEY` 설정
2. Google Cloud Console에서 Street View Static API 활성화
3. `getGoogleStreetViewUrl()` 함수로 이미지 URL 생성
4. Gemini Vision API로 이미지 분석

### 사용자에게 로드뷰 보여주기

**프론트엔드에서 카카오 로드뷰 JavaScript API 사용**:

1. 프론트엔드 HTML에 카카오맵 SDK 추가
2. JavaScript API로 로드뷰 표시
3. 사용자가 직접 로드뷰 확인

---

## 문제 해결

### "카카오 로드뷰가 안 불러와진다"

**원인**: 카카오 로드뷰는 서버 사이드 REST API가 없습니다.

**해결**:
1. **Google Street View API 사용** (권장)
   - 실제 로드뷰 이미지 가져오기 가능
   - Gemini Vision API로 분석 가능

2. **프론트엔드에서 카카오 로드뷰 JavaScript API 사용**
   - 사용자에게 로드뷰 보여주기
   - 서버 사이드에서는 불가

3. **카카오 로드뷰 페이지 링크 생성**
   - 사용자가 브라우저에서 확인
   - 이미지 직접 호출 불가

---

## 참고 링크

- [카카오 로드뷰 JavaScript API 가이드](https://apis.map.kakao.com/web/guide/)
- [Google Street View Static API 문서](https://developers.google.com/maps/documentation/streetview)
