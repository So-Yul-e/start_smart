# 카카오맵 API 로컬 환경(localhost:3000) 설정 가이드

## 개요

카카오맵 API를 로컬 개발 환경(`localhost:3000`)에서 사용하려면 **도메인 등록**이 필요합니다.

> 참고: [카카오맵 API 가이드](https://apis.map.kakao.com/web/guide/)

---

## 설정 단계

### 1. 카카오 개발자 콘솔 접속

1. [카카오 개발자 콘솔](https://developers.kakao.com/) 접속
2. 카카오 계정으로 로그인

### 2. 애플리케이션 선택 또는 생성

- 기존 애플리케이션이 있으면 선택
- 없으면 "내 애플리케이션" → "애플리케이션 추가하기"

### 3. 도메인 등록 (중요!) ⚠️

**카카오맵을 ON으로 설정했다면, 이제 도메인 등록이 필요합니다!**

#### 방법 1: "일반" 메뉴에서 확인

1. 왼쪽 사이드바에서 **앱 설정** → **앱** 섹션 클릭
2. **"일반"** 메뉴 클릭
3. **플랫폼** 섹션에서 **Web 플랫폼** 추가 버튼 찾기
4. **사이트 도메인** 입력:
   ```
   http://localhost:3000
   ```
5. **저장** 버튼 클릭

#### 방법 2: JavaScript 키의 JS SDK 도메인 사용

REST API를 사용하더라도, JavaScript 키의 "JS SDK 도메인"에 등록해야 할 수도 있습니다:

1. 현재 "플랫폼 키" 페이지에서 **JavaScript 키** 카드 확인
2. **"JS SDK 도메인"** 버튼/링크 클릭
3. 도메인 추가:
   ```
   http://localhost:3000
   ```
4. 저장

#### 방법 3: "앱 대표 도메인" vs "플랫폼 도메인" ⚠️

**중요**: "앱 기본 정보 수정"의 "앱 대표 도메인"은 카카오맵 API 도메인 등록과는 **다릅니다**!

- **"앱 대표 도메인"**: 앱의 기본 정보 (선택사항, 오류 발생 가능)
- **"플랫폼 도메인"**: 실제 API 사용을 위한 도메인 등록 (필수)

**해결 방법**:
1. "앱 대표 도메인" 필드는 **비워두거나** 실제 운영 도메인을 입력
2. 카카오맵 API 도메인 등록은 **JavaScript 키의 "JS SDK 도메인"**에서 설정

#### 방법 4: JavaScript 키의 JS SDK 도메인 설정 (권장)

**가장 확실한 방법**:

1. "플랫폼 키" 페이지로 이동
2. **JavaScript 키** 카드에서 **"JS SDK 도메인"** 버튼/링크 클릭
3. 도메인 추가:
   ```
   http://localhost:3000
   ```
4. 저장

**참고**: REST API를 사용하더라도, JavaScript 키의 도메인 설정이 영향을 줄 수 있습니다.

**현재 위치 확인**:
- ✅ "제품 설정 > 카카오맵" (카카오맵 ON 완료)
- ✅ "플랫폼 키" (REST API 키 확인 가능)
- ⚠️ "앱 대표 도메인" 오류 발생 (이 필드는 무시해도 됨)
- ⬇️ 다음 단계: **JavaScript 키의 "JS SDK 도메인"** 설정

### 4. REST API 키 확인

1. **앱 설정** → **앱 키** 메뉴 클릭
2. **REST API 키** 복사
3. `.env` 파일에 추가:
   ```bash
   KAKAO_REST_API_KEY=복사한_REST_API_키
   ```

---

## 서버 사이드 호출 시 주의사항

### 현재 프로젝트 상황

현재 `backend/market/mapApi.js`에서는 **REST API**를 사용하고 있습니다:

```javascript
// 카카오맵 REST API 사용
const url = 'https://dapi.kakao.com/v2/local/search/keyword.json';
```

### REST API vs JavaScript API

| 구분 | JavaScript API | REST API |
|------|---------------|----------|
| 사용 위치 | 프론트엔드 (브라우저) | 백엔드 (서버) |
| 도메인 등록 | JavaScript SDK 도메인 | Web 플랫폼 도메인 |
| 키 종류 | JavaScript 키 | REST API 키 |
| 현재 사용 | ❌ | ✅ |

### REST API 도메인 등록

REST API를 서버 사이드에서 호출할 때는:
1. **Web 플랫폼**에 도메인 등록 필요
2. `localhost:3000` 등록 가능
3. 서버가 실행되는 도메인과 일치해야 함

---

## 테스트 방법

### 1. 도메인 등록 확인

```bash
# 서버 실행
node backend/server.js
```

서버가 `http://localhost:3000`에서 실행되는지 확인

### 2. API 테스트

```bash
# 카카오맵 API 테스트
node backend/market/test-all-apis.js
```

### 3. 예상 결과

도메인이 제대로 등록되었다면:
- ✅ 카카오맵 API가 정상 동작
- ❌ "domain mismatched" 오류가 사라짐

---

## 문제 해결

### 오류: "domain mismatched"

**원인**: 도메인이 등록되지 않았거나 불일치

**해결**:
1. 카카오 개발자 콘솔에서 **플랫폼 설정** 확인
2. `http://localhost:3000`이 **Web 플랫폼**에 등록되어 있는지 확인
3. 서버가 정확히 `localhost:3000`에서 실행되는지 확인

### 오류: "KA Header is required"

**원인**: 서버 사이드 호출 시 헤더 문제

**해결**: 현재 코드에 이미 `User-Agent` 헤더가 추가되어 있음:
```javascript
headers: {
  'Authorization': `KakaoAK ${apiKey}`,
  'User-Agent': 'Node.js Server'
}
```

### 오류: "401 Unauthorized"

**원인**: REST API 키가 잘못되었거나 권한 문제

**해결**:
1. `.env` 파일의 `KAKAO_REST_API_KEY` 확인
2. 카카오 개발자 콘솔에서 **REST API 키** 재확인
3. 키에 공백이나 특수문자가 없는지 확인

---

## 운영 환경 설정

운영 환경에서는 실제 도메인을 등록해야 합니다:

1. **Web 플랫폼**에 운영 도메인 추가:
   ```
   https://yourdomain.com
   ```
2. 서버가 해당 도메인에서 실행되도록 설정

---

## 체크리스트

설정 완료 확인:

- [ ] 카카오 개발자 콘솔 접속
- [ ] 애플리케이션 생성 또는 선택
- [ ] **플랫폼 설정** → **Web 플랫폼** 추가
- [ ] `http://localhost:3000` 도메인 등록
- [ ] **REST API 키** 복사
- [ ] `.env` 파일에 `KAKAO_REST_API_KEY` 추가
- [ ] 서버 재시작
- [ ] API 테스트 실행

---

## 참고 링크

- [카카오맵 API 가이드](https://apis.map.kakao.com/web/guide/)
- [카카오 개발자 콘솔](https://developers.kakao.com/)
- [카카오 REST API 문서](https://developers.kakao.com/docs/latest/ko/local/dev-guide)
