# 병합(Merge) 순서 가이드

백엔드 담당자가 다른 팀원들의 작업을 통합할 때 권장하는 병합 순서입니다.

## 📋 병합 순서 (의존성 기반)

### 1단계: 공유 인터페이스 확인
```bash
# shared/interfaces.js가 변경되었는지 확인
git diff develop shared/interfaces.js
```
- **이유**: 모든 모듈이 이 파일을 참조하므로 먼저 확인 필요
- **주의**: `shared/interfaces.js`는 READ-ONLY이므로 변경 시 팀 전체 동의 필요

### 2단계: 계산 엔진 (engine/) - 독립적
```bash
# engine 브랜치 병합
git checkout develop
git pull origin develop
git merge feature/engine
```
- **이유**: 다른 모듈에 의존하지 않음 (독립적)
- **포함**: `engine/finance/`, `engine/decision/`
- **확인사항**:
  - `shared/interfaces.js` 형식 준수 여부
  - export 형식이 `orchestrator.js`에서 사용 가능한지

### 3단계: AI-로드뷰 (ai/roadview/) - 독립적
```bash
git merge feature/ai-roadview
```
- **이유**: 독립적 모듈 (Gemini API만 사용)
- **확인사항**:
  - `shared/interfaces.js`의 `roadviewAnalysisExample` 형식 준수
  - 환경변수 `GEMINI_API_KEY` 설정 확인

### 4단계: AI-컨설팅 (ai/consulting/) - 의존성 있음
```bash
git merge feature/ai-consulting
```
- **이유**: finance, market, roadview 결과를 사용할 수 있음
- **확인사항**:
  - `shared/interfaces.js`의 `aiConsultingExample` 형식 준수
  - 환경변수 `ANTHROPIC_API_KEY` 설정 확인
  - 다른 모듈 결과를 올바르게 받는지 확인

### 5단계: 프론트엔드 (frontend/) - 백엔드 API 의존
```bash
git merge feature/frontend
```
- **이유**: 백엔드 API에 의존하지만, UI는 독립적으로 개발 가능
- **확인사항**:
  - API 엔드포인트 호출 형식이 `shared/interfaces.js`와 일치하는지
  - `config.js`를 사용하여 API URL 환경변수로 관리하는지

### 6단계: 백엔드 통합 테스트
```bash
# 모든 모듈 병합 후
git checkout feature/backend
git merge develop

# 통합 테스트
npm start
# 브라우저에서 http://localhost:3000 접속하여 전체 플로우 테스트
```

## 🔍 병합 전 체크리스트

각 브랜치를 병합하기 전에 확인:

### 공통 확인사항
- [ ] `shared/interfaces.js` 형식 준수
- [ ] 환경변수 설정 가이드 제공
- [ ] README 또는 ROLE.md 업데이트
- [ ] 에러 핸들링 구현
- [ ] 로깅 구현

### 모듈별 확인사항

#### engine/
- [ ] `calculateFinance()` 함수 export 형식 확인
- [ ] `calculateDecision()` 함수 export 형식 확인
- [ ] 입력/출력 형식이 `shared/interfaces.js`와 일치

#### ai/roadview/
- [ ] `analyzeRoadview()` 함수 export 형식 확인
- [ ] `GEMINI_API_KEY` 환경변수 필요
- [ ] 응답 형식이 `roadviewAnalysisExample`과 일치

#### ai/consulting/
- [ ] `generateConsulting()` 함수 export 형식 확인
- [ ] `ANTHROPIC_API_KEY` 환경변수 필요
- [ ] 응답 형식이 `aiConsultingExample`과 일치
- [ ] 프롬프트가 `prompts.js`에 분리되어 있는지

#### frontend/
- [ ] API 호출이 `config.js`를 사용하는지
- [ ] 환경변수로 API URL 관리하는지
- [ ] 에러 처리 구현 여부

## 🚨 충돌 해결 가이드

### 1. `shared/interfaces.js` 충돌
- **절대 혼자 수정하지 마세요!**
- 팀 전체와 논의 후 수정
- 모든 모듈에 영향이 있으므로 신중하게 처리

### 2. `package.json` 충돌
- 의존성 버전 통일 필요
- `npm install` 후 테스트 필수

### 3. `.env.example` 충돌
- 모든 환경변수를 포함하도록 병합
- 실제 값은 `.env`에만 (Git에 커밋하지 않음)

## 📝 병합 후 작업

### 1. `orchestrator.js` 업데이트
```javascript
// TODO 주석 해제 및 import 경로 확인
const { calculateFinance } = require('../../engine/finance');
const { analyzeRoadview } = require('../../ai/roadview');
const { generateConsulting } = require('../../ai/consulting');
const { calculateDecision } = require('../../engine/decision');
```

### 2. 통합 테스트
```bash
# 서버 실행
npm start

# 전체 플로우 테스트
# 1. 브랜드 선택
# 2. 조건 입력
# 3. 분석 실행
# 4. 결과 확인
# 5. 리포트 생성
```

### 3. 에러 확인
- 콘솔 로그에서 각 단계별 에러 확인
- 모듈별 담당자에게 피드백

## ⚠️ 주의사항

1. **한 번에 하나씩 병합**: 여러 브랜치를 동시에 병합하지 마세요
2. **각 병합 후 테스트**: 병합 후 바로 테스트하여 문제 조기 발견
3. **커밋 메시지 명확히**: 어떤 모듈을 병합했는지 명확히 기록
4. **develop 브랜치 사용**: `main`이 아닌 `develop` 브랜치에 병합

## 🔄 롤백 방법

문제 발생 시:
```bash
# 마지막 병합 취소
git reset --hard HEAD~1

# 또는 특정 커밋으로 되돌리기
git log  # 커밋 해시 확인
git reset --hard <커밋해시>
```
