# 분석 API 500 에러 해결 방법

## 현재 상황

프론트엔드에서 분석 실행 시 `/api/analyze` 엔드포인트에서 500 에러가 발생합니다.

## 확인해야 할 사항

### 1. 서버 콘솔 로그 확인 (가장 중요!)

서버를 실행한 터미널에서 다음 로그를 확인하세요:

```
[분석 요청] 요청 받음
[분석 요청] 요청 본문: {...}
[분석 요청] 입력 검증 시작: {...}
[분석 요청] 분석 ID 생성: analysis_xxx
[분석 요청] DB 저장 시작...
[createAnalysis] 입력 데이터: {...}
[createAnalysis] DB 쿼리 오류: ...  <-- 여기서 에러 발생 가능
```

**에러가 발생하면:**
- `[createAnalysis] DB 쿼리 오류 메시지:` 확인
- `[createAnalysis] DB 쿼리 오류 코드:` 확인 (예: 23503 = 외래키 제약 위반)

### 2. 브랜드 ID 확인

브라우저 콘솔에서 보낸 `brandId: 'brand_3'`가 DB에 존재하는지 확인:

```bash
# 브랜드 목록 확인
curl http://172.16.48.47:3000/api/brands
```

또는 PostgreSQL에서:

```sql
SELECT id, name FROM brands;
```

### 3. 가능한 원인

#### 원인 1: 브랜드 ID가 존재하지 않음
- **에러 코드**: `23503` (외래키 제약 위반)
- **해결**: 브랜드 선택 페이지에서 올바른 `brandId`가 전달되는지 확인

#### 원인 2: DB 연결 오류
- **에러 메시지**: `connection refused` 또는 `timeout`
- **해결**: PostgreSQL이 실행 중인지 확인

#### 원인 3: 데이터 타입 오류
- **에러 메시지**: `invalid input syntax`
- **해결**: 숫자 필드가 올바르게 파싱되었는지 확인

## 해결 방법

### 즉시 확인할 것

1. **서버 콘솔 로그 확인**
   - 서버를 실행한 터미널에서 `[분석 요청]` 또는 `[createAnalysis]` 로그 확인
   - 에러 메시지와 스택 트레이스 확인

2. **브랜드 ID 확인**
   ```bash
   curl http://172.16.48.47:3000/api/brands | grep -i "brand_3"
   ```

3. **DB 직접 확인**
   ```sql
   -- PostgreSQL 접속
   psql -U postgres -d startsmart
   
   -- 브랜드 확인
   SELECT id, name FROM brands WHERE id = 'brand_3';
   
   -- 테이블 구조 확인
   \d analyses
   ```

## 다음 단계

서버 콘솔에 출력된 **정확한 에러 메시지**를 알려주시면 구체적인 해결 방법을 제시하겠습니다.

특히 다음 정보가 중요합니다:
- `[createAnalysis] DB 쿼리 오류 메시지:`
- `[createAnalysis] DB 쿼리 오류 코드:`
- `[분석 요청] 오류 메시지:`
- `[분석 요청] 오류 스택:`
